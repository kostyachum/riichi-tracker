{% extends 'base.html' %}
{% load humanize %}
{% block content %}

<header class="flex items-baseline justify-between mb-6">
  <h1 class="text-2xl font-semibold tracking-tight">
    {{ player.name }}
  </h1>
  <a href="/" class="text-sky-700 hover:underline text-sm font-medium">‚Üê Back to games</a>
</header>

{% if games %}
  <!-- Stats summary -->
  <div class="flex flex-wrap gap-4 mb-6">
    <div class="badge badge-outline text-sm">Games: {{ games|length }}</div>
    <span class="badge badge-outline">Wins: {{ stats.wins }}</span>
    <span class="badge badge-outline">Win Rate: {{ stats.win_rate|floatformat:1 }}%</span>
    <span class="badge badge-outline">Average Rank: {{ stats.avg_rank|floatformat:2 }}</span>
    <div class="badge badge-outline text-sm">
      Average Result: {{ stats.avg_score|floatformat:1 }}
    </div>
    <div class="badge badge-outline text-sm">
      Average Points: {{ stats.avg_raw|floatformat:0 |intcomma}}
    </div>
  </div>

  <!-- Chart container -->
    <h2 class="font-semibold text-lg mb-4">Trends</h2>
  <div class="card bg-base-100 shadow-md p-4">
    <div class="relative h-48 ">
      <canvas id="rankTrendChart"></canvas>
    </div>
  </div>

  <h2 class="font-semibold text-lg mb-4 mt-8">Recent Games</h2>

  <!-- Games list -->
  <div class="space-y-4 ">
    {% for game in games %}
      {% include "games/game_card.html" with game=game target_player_id=player.id %}
    {% endfor %}
  </div>
{% else %}
  <div class="rounded-lg border border-dashed border-slate-300 bg-white p-8 text-center">
    <p class="text-slate-600">No games found for {{ player.name }}.</p>
  </div>
{% endif %}

{% endblock %}


{% block extra_scripts %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('rankTrendChart');
    const data = {
      labels: [...Array({{ recent_ranks|length }})].map((_, i) => i + 1),
      datasets: [{
        data: {{ recent_ranks|safe }},
        borderColor: '#f97316',
        backgroundColor: '#facc15',
        fill: false,
        pointRadius: 5,
        borderWidth: 2,
      }]
    };
    const options = {
        responsive: true,
        scales: {
            y: {
                reverse: true,
                min: 0,
                max: 5,
                ticks: {
                    stepSize: 1,
                    callback: v => ['1st', '2nd', '3rd', '4th'][v - 1] || ''
                },
            },
            x: {grid: {display: false},}
        },
        plugins: {legend: {display: false}}
    }

    new Chart(ctx, { type: 'line', data, options });

  </script>
{% endblock %}